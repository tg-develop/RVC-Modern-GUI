"use strict";(self.webpackChunkmodern_gui=self.webpackChunkmodern_gui||[]).push([[792],{7167:(e,t,r)=>{var s=r(4848),n=r(5338),a=r(6540),i=r.n(a);const l={type:"demo",front:{modelSlotControl:[]}},o=(0,a.createContext)(null),d=()=>{const e=(0,a.useContext)(o);if(!e)throw new Error("useAppRoot must be used within an AppRootProvider");return e},c=(0,a.createContext)(void 0),g=()=>{const e=(0,a.useContext)(c);if(!e)throw new Error("useAppState must be used within AppContextProvider");return e},u=({children:e})=>{const[t,r]=(0,a.useState)((()=>{const e=localStorage.getItem("theme");return e||(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}));(0,a.useEffect)((()=>{localStorage.setItem("theme",t),"dark"===t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}),[t]);return(0,s.jsx)(c.Provider,{value:{theme:t,toggleTheme:()=>{r((e=>"light"===e?"dark":"light"))}},children:e})};var m=r(2098);const x=i().createContext(null),h=()=>{const e=(0,a.useContext)(x);if(!e)throw new Error("useAppState must be used within AppContextProvider");return e},v=({children:e})=>{const t=d(),r=(n={audioContext:t.audioContextState.audioContext},{clientState:(0,m.useClient)({audioContext:n.audioContext})});var n;const i=(0,a.useRef)(!1);(0,a.useEffect)((()=>{r.clientState.initialized&&(i.current=!0,r.clientState.getInfo(),r.clientState.setWorkletNodeSetting({...r.clientState.setting.workletNodeSetting,serverUrl:"http://localhost:18888"}))}),[r.clientState.initialized]);const l={audioContext:t.audioContextState.audioContext,...r.clientState,initializedRef:i};return(0,s.jsx)(x.Provider,{value:l,children:e})};var p=r(982),b=r(6188);const f=({message:e})=>(0,s.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-75 backdrop-blur-md flex flex-col justify-center items-center z-50 p-4",children:[(0,s.jsx)("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,s.jsx)("p",{className:"text-white text-lg font-semibold",children:"Loading..."}),(0,s.jsx)("p",{className:"text-slate-300 text-sm",children:e})]}),S=({errors:e,removeError:t})=>(0,s.jsx)("div",{className:"fixed top-4 right-4 space-y-2 z-50",children:e.map((e=>(0,s.jsxs)("div",{className:`max-w-sm w-full p-4 rounded shadow flex justify-between items-start\n          ${"Error"===e.type?"bg-red-100 border border-red-400":""}\n          ${"Warning"===e.type?"bg-yellow-100 border border-yellow-400":""}\n          ${"Confirm"===e.type?"bg-blue-100 border border-blue-400":""}`,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{className:"block text-sm font-medium",children:e.type}),(0,s.jsx)("p",{className:"text-sm",children:e.message})]}),(0,s.jsx)("button",{onClick:()=>t(e.id),className:"ml-4 text-lg font-bold leading-none",children:"Ã—"})]},e.id)))}),j=(0,a.createContext)(void 0),y=({children:e})=>{const t=h(),[r,n]=(0,a.useState)(!1),[i,l]=(0,a.useState)(!1),[o,d]=(0,a.useState)([]),[c,g]=(0,a.useState)([]),[u,m]=(0,a.useState)("none"),[x,v]=(0,a.useState)("none"),[p,b]=(0,a.useState)("none"),[y,N]=(0,a.useState)(),[k,C]=(0,a.useState)([]),w=(0,a.useRef)(0),I=(0,a.useCallback)((e=>{N(e),n(!0)}),[]),A=(0,a.useCallback)((()=>{n(!1),N(void 0)}),[]),M=(0,a.useCallback)(((e,t="Error")=>{w.current+=1;const r=w.current;C((s=>[...s,{id:r,message:e,type:t}])),setTimeout((()=>{C((e=>e.filter((e=>e.id!==r))))}),5e3)}),[]),F=(0,a.useCallback)((e=>{C((t=>t.filter((t=>t.id!==e))))}),[]),E=(0,a.useRef)(!1),D=async()=>{if(0==E.current)try{(await navigator.mediaDevices.getUserMedia({video:!1,audio:!0})).getTracks().forEach((e=>{e.stop()})),E.current=!0}catch(e){}const e=await navigator.mediaDevices.enumerateDevices();return[e.filter((e=>"audioinput"==e.kind)),e.filter((e=>"audiooutput"==e.kind))]};return(0,a.useEffect)((()=>{1==t.serverSetting.serverSetting.serverAudioStated&&l(!0)}),[t.serverSetting.serverSetting.serverAudioStated]),(0,a.useEffect)((()=>{let e=!0;const t=async()=>{const r=(e,t)=>({deleted:new Set([...e].filter((e=>!t.has(e)))),added:new Set([...t].filter((t=>!e.has(t))))});try{const s=await D(),n=new Set(o.map((e=>e.deviceId))),a=new Set(s[0].map((e=>e.deviceId))),i=new Set(c.map((e=>e.deviceId))),l=new Set(s[1].map((e=>e.deviceId))),u=r(n,a),m=r(i,l);(u.deleted.size>0||u.added.size>0)&&d(s[0]),(m.deleted.size>0||m.added.size>0)&&g(s[1]),e&&setTimeout(t,3e3)}catch(e){}};return t(),()=>{e=!1}}),[o,c]),(0,s.jsxs)(j.Provider,{value:{startLoading:I,stopLoading:A,showError:M,setIsConverting:l,reloadDeviceInfo:async()=>{const e=await D();d(e[0]),g(e[1])},isConverting:i,setAudioInputForGUI:m,setAudioOutputForGUI:v,setAudioMonitorForGUI:b,inputAudioDeviceInfo:o,outputAudioDeviceInfo:c,audioInputForGUI:u,audioOutputForGUI:x,audioMonitorForGUI:p},children:[e,r&&(0,s.jsx)(f,{message:y}),(0,s.jsx)(S,{errors:k,removeError:F})]})},N=()=>{const e=(0,a.useContext)(j);if(!e)throw new Error("useUIContext must be used within a UIContextProvider");return e},k=(e,t)=>(0,a.useMemo)((()=>{const{size:r=100,backgroundColor:s=null,textColor:n="#ffffff",shape:a="rounded",fontSize:i=null,fontFamily:l="Arial"}=t||{},o=e.charAt(0).toUpperCase();let d=s;if(!d){const t=e.split("").reduce(((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e),0),r=["#007bff","#28a745","#dc3545","#ffc107","#17a2b8","#6f42c1","#e83e8c","#fd7e14"];d=r[Math.abs(t)%r.length]}return`data:image/svg+xml;base64,${btoa(`\n            <svg width="${r}" height="${r}" xmlns="http://www.w3.org/2000/svg">\n                <defs>\n                    <clipPath id="clip">\n                        <rect width="${r}" height="${r}" rx="${"circle"===a?r/2:"rounded"===a?.1*r:0}" ry="${"circle"===a?r/2:"rounded"===a?.1*r:0}"/>\n                    </clipPath>\n                </defs>\n                <rect width="100%" height="100%" fill="${d}" clip-path="url(#clip)"/>\n                <text x="50%" y="50%" font-family="${l}" font-size="${i||.4*r}" \n                      fill="${n}" text-anchor="middle" dy=".3em" clip-path="url(#clip)">${o}</text>\n            </svg>\n        `)}`}),[e,t]);const C=function(e){const t=e.model.iconFile.length>0?"http://127.0.0.1:18888/"+e.modelDir+"/"+e.model.slotIndex+"/"+e.model.iconFile.split(/[\/\\]/).pop():"",r=k(e.model.name);return(0,s.jsxs)("li",{className:"p-2.5 text-sm rounded-md cursor-pointer flex items-center group text-slate-700 dark:text-slate-300 \n                "+(e.selected?"bg-sky-100 dark:bg-blue-700/30 border border-blue-500":"hover:bg-slate-100 dark:hover:bg-gray-700"),onClick:()=>{e.handleSelectModel(e.model)},children:[(0,s.jsx)("img",{src:t.length>0?t:r,alt:e.model.name,className:"w-8 h-8 md:w-10 md:h-10 rounded-md mr-3 object-cover flex-shrink-0"}),(0,s.jsx)("span",{className:"truncate mr-2 flex-grow",children:e.model.name}),(0,s.jsxs)("div",{className:"flex space-x-2 md:space-x-1 items-center md:opacity-0 group-hover:md:opacity-100 transition-opacity",children:[(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),e.openModal("editModel",{model:e.model})},className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 p-1 md:p-0",title:"Edit Model",children:(0,s.jsx)(p.g,{icon:b.hpd,className:"h-4 w-4 md:h-3 md:w-3"})}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),e.openModal("deleteModel",{model:e.model})},className:"text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 p-1 md:p-0",title:"Delete Model",children:(0,s.jsx)(p.g,{icon:b.yLS,className:"h-4 w-4 md:h-3 md:w-3"})})]})]})};const w=function({filteredAndSortedModels:e,openModal:t,handleSelectModel:r,confirmedSelectedSlotIndex:n,appState:a}){return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("ul",{className:"space-y-2 flex-grow overflow-y-auto min-h-[100px]",children:e.length>0?e.map((e=>(0,s.jsx)(C,{model:e,openModal:t,handleSelectModel:r,modelDir:a.serverSetting.serverSetting.voiceChangerParams.model_dir,selected:e.slotIndex===n},e.slotIndex))):(0,s.jsx)("p",{className:"text-center text-sm text-slate-500 dark:text-gray-400 py-4",children:"No models match your criteria."})})})},I="w-full p-2 border border-slate-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-slate-900 dark:text-gray-100 text-sm transition-colors duration-150",A="w-full p-2 border border-slate-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-slate-900 dark:text-gray-100 text-sm",M="w-full h-2 bg-slate-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500 dark:accent-blue-400 transition-colors duration-150",F="w-full h-2 bg-slate-100 dark:bg-gray-700 rounded-lg appearance-none cursor-not-allowed accent-slate-300 dark:accent-gray-500 opacity-50 transition-colors duration-150",E="mr-2 accent-blue-500 dark:accent-blue-400",D="mr-2 accent-blue-500 dark:accent-blue-400",T="block text-sm font-medium text-slate-600 dark:text-gray-400 mt-1 mb-1",$="text-lg font-semibold text-slate-700 dark:text-gray-200",O="text-xs text-slate-600 dark:text-gray-400 text-right",R="flex items-center text-sm text-slate-700 dark:text-gray-300",P="inline-flex items-center mr-4 text-sm text-slate-700 dark:text-gray-300",L="p-1 text-slate-500 hover:text-slate-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors duration-150",U="px-4 py-2 rounded-md text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 bg-blue-500 hover:bg-blue-600 text-white rounded-md transition-colors duration-150",z="px-4 py-2 rounded-md text-sm font-medium focus:outline-none focus:ring-2 focus:ring-offset-2 bg-slate-200 hover:bg-slate-300 text-slate-700 dark:bg-gray-600 dark:hover:bg-gray-500 dark:text-gray-200 focus:ring-slate-400",G="INDEXEDDB_KEY_AUDIO_INPUT",_="INDEXEDDB_KEY_AUDIO_OUTPUT",B="INDEXEDDB_KEY_AUDIO_MONITOR",V="INDEXEDDB_KEY_NOISE1",W="INDEXEDDB_KEY_NOISE2",K="INDEXEDDB_KEY_ECHO",H=[{value:"slot",label:"Slot"},{value:"name",label:"Name"}];const J=function({appState:e,setFilteredAndSortedModels:t}){const[r,n]=(0,a.useState)(""),[i,l]=(0,a.useState)("slot"),[o,d]=(0,a.useState)("All"),[c,g]=(0,a.useState)("All"),[u,x]=(0,a.useState)("All"),[h,v]=(0,a.useState)(!1),[f,S]=(0,a.useState)("asc"),j=(0,a.useMemo)((()=>e.serverSetting?.serverSetting?.modelSlots?e.serverSetting.serverSetting.modelSlots.filter((e=>e.voiceChangerType===m.VoiceChangerType.RVC&&""!==e.name&&"number"==typeof e.slotIndex)).map((e=>({...e,slotIndex:e.slotIndex}))):[]),[e.serverSetting?.serverSetting?.modelSlots]),y=(0,a.useMemo)((()=>{const e=new Set;return j.forEach((t=>{t.voiceChangerType&&e.add(`${t.voiceChangerType}`)})),["All",...Array.from(e).sort()]}),[j]),N=(0,a.useMemo)((()=>{const e=new Set;return j.forEach((t=>{t.samplingRate&&e.add(t.samplingRate)})),["All",...Array.from(e).sort(((e,t)=>e-t))]}),[j]),k=(0,a.useMemo)((()=>{const e=new Set;return j.forEach((t=>{t.embedder&&e.add(t.embedder)})),["All",...Array.from(e).sort()]}),[j]);return(0,a.useEffect)((()=>{let e=[...j];r&&(e=e.filter((e=>e.name.toLowerCase().includes(r.toLowerCase())))),"All"!==o&&(e=e.filter((e=>e.voiceChangerType&&e.version&&`${e.voiceChangerType} ${e.version}`===o))),"All"!==c&&(e=e.filter((e=>e.samplingRate===c))),"All"!==u&&(e=e.filter((e=>e.embedder===u))),e.sort(((e,t)=>{let r=0;return"slot"===i?r=e.slotIndex-t.slotIndex:"name"===i&&(r=e.name.localeCompare(t.name)),"asc"===f?r:-r})),t(e)}),[j,r,i,o,c,u,f]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"relative mb-2",children:[(0,s.jsx)("input",{type:"search",placeholder:"Search Models...",value:r,onChange:e=>n(e.target.value),className:"w-full p-2 pr-10 border border-slate-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-sm placeholder-slate-400 dark:placeholder-gray-500 text-slate-700 dark:text-slate-100"}),(0,s.jsx)(p.g,{icon:b.MjD,className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 dark:text-gray-500"})]}),(0,s.jsx)("div",{className:"mb-2",children:(0,s.jsxs)("button",{onClick:()=>v(!h),className:"w-full flex items-center justify-between p-2 text-sm font-medium text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-md border border-slate-300 dark:border-gray-600",children:[(0,s.jsxs)("span",{children:[(0,s.jsx)(p.g,{icon:b.mRM,className:"mr-2"})," Filter & Sort"]}),(0,s.jsx)(p.g,{icon:h?b.GRI:b.OM7})]})}),h&&(0,s.jsxs)("div",{className:"space-y-3 mb-3 p-3 border border-slate-200 dark:border-gray-700 rounded-md",children:[(0,s.jsxs)("div",{className:"space-y-1 pb-2 border-b border-slate-200 dark:border-gray-700",children:[(0,s.jsxs)("label",{htmlFor:"sortOption",className:"text-xs font-medium text-slate-600 dark:text-gray-300 flex items-center",children:[(0,s.jsx)(p.g,{icon:b.OM7,className:"mr-1.5"}),"Sort by:"]}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsx)("select",{id:"sortOption",value:i,onChange:e=>l(e.target.value),className:`${I} flex-grow`,children:H.map((e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value)))}),(0,s.jsxs)("button",{onClick:()=>S((e=>"asc"===e?"desc":"asc")),className:"p-1.5 border border-slate-300 dark:border-gray-600 rounded-md hover:bg-slate-50 dark:hover:bg-gray-600 text-slate-600 dark:text-gray-300",title:"asc"===f?"Sort Descending":"Sort Ascending",children:["asc"===f?(0,s.jsx)("span",{className:"text-xs",children:"ASC"}):(0,s.jsx)("span",{className:"text-xs",children:"DESC"})," "]})]})]}),(0,s.jsxs)("div",{className:"space-y-1 pt-2",children:[(0,s.jsxs)("p",{className:"text-xs font-medium text-slate-600 dark:text-gray-300 flex items-center mb-1",children:[(0,s.jsx)(p.g,{icon:b.mRM,className:"mr-1.5"}),"Filter by:"]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 items-center",children:[(0,s.jsx)("label",{htmlFor:"typeVersionFilter",className:"text-xs font-medium text-slate-500 dark:text-gray-400",children:"Type:"}),(0,s.jsx)("select",{id:"typeVersionFilter",value:o,onChange:e=>d(e.target.value),className:I,children:y.map((e=>(0,s.jsx)("option",{value:e,children:e},e)))})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 items-center",children:[(0,s.jsx)("label",{htmlFor:"rateFilter",className:"text-xs font-medium text-slate-500 dark:text-gray-400",children:"Rate:"}),(0,s.jsx)("select",{id:"rateFilter",value:"All"===c?"All":c,onChange:e=>g("All"===e.target.value?"All":Number(e.target.value)),className:I,children:N.map((e=>(0,s.jsx)("option",{value:e,children:"All"===e?"All":e/1e3+"kHz"},e)))})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 items-center",children:[" ",(0,s.jsx)("label",{htmlFor:"embedderFilter",className:"text-xs font-medium text-slate-500 dark:text-gray-400",children:"Embedder:"}),(0,s.jsx)("select",{id:"embedderFilter",value:u,onChange:e=>x(e.target.value),className:I,children:k.map((e=>(0,s.jsx)("option",{value:e,children:e},e)))})]})]})]})]})};var X=r(961);const Y=function({isOpen:e,onClose:t,title:r,children:n,primaryButton:a,secondaryButton:i,transparent:l=!1,closeOnOutsideClick:o=!0,size:d="medium"}){if(!e)return null;const c=document.getElementById("modal-root");return c?(0,X.createPortal)((0,s.jsx)("div",{className:`fixed inset-0 ${!1===l?"bg-black bg-opacity-50 backdrop-blur-sm":"opacity-100"}  flex justify-center items-center z-50 p-4 transition-opacity duration-300 ease-in-out`,onClick:o?t:void 0,children:(0,s.jsxs)("div",{className:`bg-white dark:bg-gray-800 p-6 rounded-lg shadow-xl w-full ${(e=>{switch(e){case"small":return"max-w-md";case"medium":default:return"max-w-4xl";case"large":return"max-w-7xl"}})(d)} max-h-[90vh] flex flex-col transform transition-all duration-300 ease-in-out scale-95 opacity-0 animate-modalFadeInScaleUp overflow-hidden`,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4 pb-3 border-b border-slate-200 dark:border-gray-700",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-slate-800 dark:text-gray-100",children:r}),(0,s.jsx)("button",{onClick:t,className:"text-slate-500 hover:text-slate-700 dark:text-gray-400 dark:hover:text-gray-200 p-1 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500","aria-label":"Close modal",children:(0,s.jsx)(p.g,{icon:b.GRI,className:"h-5 w-5"})})]}),(0,s.jsx)("div",{className:"overflow-y-auto mb-6 flex-grow",children:n}),(a||i)&&(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-3 border-t border-slate-200 dark:border-gray-700",children:[i&&(0,s.jsx)("button",{onClick:i.onClick,className:`${z} ${i.className||""} ${i.disabled?"opacity-50 cursor-not-allowed":""}`,disabled:i.disabled,children:i.text}),a&&(0,s.jsx)("button",{onClick:a.onClick,className:`${U} ${a.className||""} ${a.disabled?"opacity-50 cursor-not-allowed":""}`,disabled:a.disabled,children:a.text})]})]})}),c):null};const q=function({appState:e,guiState:t,showUpload:r,setShowUpload:n}){const[i,l]=(0,a.useState)({modelName:"",thumbnailFile:null,voiceChangerType:"RVC",slot:0,isSampleMode:!1,sampleId:null,files:[],params:{},embedder:"hubert_base"}),[o,d]=(0,a.useState)(null),[c,g]=(0,a.useState)(!1),[u,m]=(0,a.useState)("settings");(0,a.useEffect)((()=>{const e=i.files.find((e=>"rvcModel"===e.kind));if(e){const t=e.file.name.substring(0,e.file.name.lastIndexOf("."));l({...i,modelName:t})}o&&g(!0)}),[i.files]);const x=()=>{e.serverSetting.isUploading||(n(!1),l({modelName:"",thumbnailFile:null,voiceChangerType:"RVC",slot:0,isSampleMode:!1,sampleId:null,files:[],params:{},embedder:"hubert_base"}))},h="block text-sm font-medium text-slate-600 dark:text-gray-400 mb-1",v="w-full p-2 border border-slate-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-slate-900 dark:text-gray-100 text-sm transition-colors duration-150",p=`${v} file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 dark:file:bg-gray-600 file:text-blue-700 dark:file:text-blue-300 hover:file:bg-blue-100 dark:hover:file:bg-gray-500`;return(0,s.jsx)(Y,{isOpen:r,onClose:x,title:"Upload Model",closeOnOutsideClick:!1,primaryButton:{text:""+(e.serverSetting.isUploading?`Uploading... (${e.serverSetting.uploadProgress.toFixed(1)}%)`:"Upload"),onClick:async()=>{if(!i.files)return void t.showError("Please select a model file.","Error");if(i.modelName.trim())try{let r=-1;const s=e.serverSetting.serverSetting.modelSlots;if(s&&s.length>0&&(r=s.findIndex((e=>!e.name||0===e.name.length))),-1===r)return void t.showError("No empty model slot available. Please clear a slot or manage existing ones.","Error");const n=[{kind:"rvcModel",file:i.files[0].file,dir:""}];i.files[1]&&n.push({kind:"rvcIndex",file:i.files[1].file,dir:""});const a={voiceChangerType:"RVC",slot:r,files:n,isSampleMode:!1,sampleId:null,params:{},embedder:i.embedder};await e.serverSetting.uploadModel(a),i.thumbnailFile&&await e.serverSetting.uploadAssets(r,"iconFile",i.thumbnailFile),t.showError("Model uploaded successfully!","Confirm"),await e.serverSetting.reloadServerInfo(),x()}catch(e){t.showError(`Error uploading model: ${e instanceof Error?e.message:String(e)}`,"Error")}else t.showError("Please enter a model name.","Error")},className:U,disabled:e.serverSetting.isUploading},secondaryButton:{text:"Cancel",onClick:x,className:z,disabled:e.serverSetting.isUploading},children:(0,s.jsxs)("div",{className:"space-y-4 py-2 max-h-[70vh] overflow-y-auto pr-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"modelFile",className:h,children:"Model File (.pth, .safetensors, .onnx):"}),(0,s.jsx)("input",{type:"file",id:"modelFile",accept:".pth,.safetensors,.onnx",onChange:e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0],r={kind:"rvcModel",file:t,dir:""},s=i.files.filter((e=>"rvcModel"!==e.kind));s.push(r),l({...i,files:s,modelName:t.name.replace(/\.[^/.]+$/,"")})}else{const e=i.files.filter((e=>"rvcModel"!==e.kind));l({...i,files:e,modelName:""})}},className:p,disabled:e.serverSetting.isUploading})]}),i.files.find((e=>"rvcModel"===e.kind))&&(0,s.jsxs)("div",{className:"space-y-4 ml-2 pl-3 border-l-2 border-slate-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"modelName",className:h,children:"Model Name:"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",id:"modelName",value:i.modelName,onChange:e=>l({...i,modelName:e.target.value}),className:`${v} pl-3 pr-10 py-2 bg-white/50 dark:bg-gray-700/50 border-slate-300/70 dark:border-gray-600/70 focus:ring-2 focus:ring-blue-500/50 focus:border-transparent text-sm`,placeholder:"Enter a descriptive name for your model",disabled:e.serverSetting.isUploading}),(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,s.jsx)("svg",{className:"h-4 w-4 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{htmlFor:"embedderType",className:h,children:"Embedder Type:"}),(0,s.jsxs)("select",{id:"embedderType",value:i.embedder,onChange:e=>l({...i,embedder:e.target.value}),className:"w-full p-2 border border-slate-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-slate-900 dark:text-gray-100 text-sm transition-colors duration-150",disabled:e.serverSetting.isUploading,children:[(0,s.jsx)("option",{value:"hubert_base",children:"Hubert_Base / Contentvec (Default)"}),(0,s.jsx)("option",{value:"spin_base",children:"SPIN"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"indexFile",className:h,children:"Index File (.index) (Optional):"}),(0,s.jsx)("input",{type:"file",id:"indexFile",accept:".index",onChange:e=>{if(e.target.files&&e.target.files[0]){const t={kind:"rvcIndex",file:e.target.files[0],dir:""},r=i.files.filter((e=>"rvcIndex"!==e.kind));r.push(t),l({...i,files:r})}else{const e=i.files.filter((e=>"rvcIndex"!==e.kind));l({...i,files:e})}},className:p,disabled:e.serverSetting.isUploading})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"thumbnailFile",className:h,children:"Thumbnail Image (Optional):"}),(0,s.jsx)("input",{type:"file",id:"thumbnailFile",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){const t=e.target.files[0];l({...i,thumbnailFile:t});const r=new FileReader;r.onloadend=()=>{d(r.result)},r.readAsDataURL(t)}else l({...i,thumbnailFile:null}),d(null)},className:p,disabled:e.serverSetting.isUploading})]}),o&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>g(!c),className:"flex items-center justify-between w-full text-sm font-medium text-slate-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors disabled:opacity-50",disabled:e.serverSetting.isUploading,children:[(0,s.jsx)("span",{children:"Preview Thumbnail"}),(0,s.jsx)("svg",{className:"ml-2 h-4 w-4 transition-transform duration-200 "+(c?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&(0,s.jsxs)("div",{className:"space-y-4 p-3 bg-slate-50 dark:bg-gray-800/30 rounded-lg border border-slate-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-slate-600 dark:text-gray-300",children:"Preview Mode:"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),m("settings")},className:`px-3 py-1 text-xs rounded-md transition-colors ${"settings"===u?"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300":"text-slate-500 hover:bg-slate-100 dark:text-gray-400 dark:hover:bg-gray-700"} disabled:opacity-50`,disabled:e.serverSetting.isUploading,children:"Settings"}),(0,s.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),m("list")},className:`px-3 py-1 text-xs rounded-md transition-colors ${"list"===u?"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300":"text-slate-500 hover:bg-slate-100 dark:text-gray-400 dark:hover:bg-gray-700"} disabled:opacity-50`,disabled:e.serverSetting.isUploading,children:"List"})]})]}),(0,s.jsx)("div",{className:"flex items-center justify-center p-4",children:(0,s.jsx)("div",{className:`transition-all duration-200 ${"settings"===u?"w-32 h-32 rounded-full p-1.5 border-2 border-slate-300 dark:border-gray-500":"w-36 h-36 rounded-xl p-1.5 border border-slate-300 dark:border-gray-500"} bg-white dark:bg-gray-800 shadow-md overflow-hidden`,children:(0,s.jsx)("img",{src:o,alt:"Thumbnail preview",className:"w-full h-full object-cover "+("settings"===u?"rounded-full":"rounded-lg")})})})]})]})]})})};const Q=function({isSidebarOpen:e,toggleSidebar:t,openModal:r}){const n=h(),i=N(),[l,o]=(0,a.useState)(!1),[d,c]=(0,a.useState)([]),g=n.serverSetting?.serverSetting?.modelSlotIndex??null;let u="bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 p-4 space-y-4 transition-all duration-300 ease-in-out flex flex-col";u+=e?" w-full md:w-72 z-10":" w-0 p-0 overflow-hidden";let m="bg-white dark:bg-gray-800 text-slate-700 dark:text-gray-200 border-r border-slate-200 dark:border-gray-700 p-4 space-y-4 transition-all duration-300 ease-in-out flex flex-col z-20 ";return m+=e?"fixed inset-y-0 left-0 w-full transform translate-x-0 md:static md:w-72 md:translate-x-0":"fixed -left-full w-full transform -translate-x-full md:static md:w-0 md:p-0 md:overflow-hidden md:border-r-0",(0,s.jsxs)("div",{className:m,children:[(0,s.jsxs)("div",{className:"flex items-center mb-2 md:mb-0 justify-center relative",children:[e&&(0,s.jsx)("img",{src:"/logo.png",alt:"Logo",className:"h-10 md:h-12 "+(e?"mx-auto md:mx-0":"mx-auto")}),e&&(0,s.jsx)("button",{onClick:t,className:"md:hidden p-2 text-slate-600 dark:text-gray-300 self-start absolute top-0 right-0 z-10","aria-label":"Close sidebar",children:(0,s.jsx)(p.g,{icon:b.GRI,size:"lg"})})]}),e&&(0,s.jsx)("hr",{className:"hidden md:block border-slate-300 dark:border-gray-600 my-3"}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-slate-800 dark:text-gray-100 "+(e?"mt-2 md:mt-0 text-center md:text-left":"mt-0 hidden"),children:"Model Selector"}),e&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q,{appState:n,guiState:i,showUpload:l,setShowUpload:o}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsxs)("span",{className:"text-sm font-medium text-slate-600 dark:text-gray-400",children:["Available Models (",d.length,")"]}),(0,s.jsx)("button",{onClick:()=>o(!0),className:"p-1 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",title:"Upload New Model",children:(0,s.jsx)(p.g,{icon:b.QLR,size:"lg"})})]}),(0,s.jsx)(J,{appState:n,setFilteredAndSortedModels:c}),(0,s.jsx)("hr",{className:"border-slate-300 dark:border-gray-600 my-2"}),(0,s.jsx)(w,{filteredAndSortedModels:d,openModal:r,handleSelectModel:async e=>{i.startLoading(`Swapping to model: ${e.name}`),await n.serverSetting.updateServerSettings({...n.serverSetting.serverSetting,modelSlotIndex:e.slotIndex}),i.stopLoading()},confirmedSelectedSlotIndex:g,appState:n})]})]})};const Z=function({sampleRate:e,setSampleRate:t,embedder:r,setEmbedder:n,searchText:a,setSearchText:i,onFilterChange:l}){return(0,s.jsxs)("div",{className:"space-y-4 p-4 bg-slate-50 dark:bg-gray-800/30 rounded-lg border border-slate-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,s.jsx)("h4",{className:"text-md font-medium text-slate-700 dark:text-gray-200",children:"Filter Settings"}),(0,s.jsx)(p.g,{icon:b.mRM,className:"h-4 w-4 text-slate-500 dark:text-gray-400"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:T,children:"Search Models:"}),(0,s.jsx)("input",{type:"text",value:a,onChange:e=>i(e.target.value),placeholder:"Search by model name...",className:A})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:T,children:"Sample Rate:"}),(0,s.jsx)("select",{value:e,onChange:e=>{return r=Number(e.target.value),t(r),void l();var r},className:I,children:[32e3,4e4,48e3].map((e=>(0,s.jsxs)("option",{value:e,children:[e," Hz"]},e)))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:T,children:"Embedder:"}),(0,s.jsxs)("select",{value:r,onChange:e=>{return t=e.target.value,n(t),void l();var t},className:I,children:[(0,s.jsx)("option",{value:"hubert_base",children:"Hubert_Base / Contentvec"}),(0,s.jsx)("option",{value:"spin_base",children:"SPIN"})]})]})]})]})]})};const ee=function({models:e,selectedModels:t,onModelToggle:r,onPercentageChange:n,modelDir:a}){const i=e=>t.some((t=>t.slot.slotIndex===e.slotIndex));return(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h4",{className:"text-md font-medium text-slate-700 dark:text-gray-200",children:"Available Models"}),0===e.length?(0,s.jsx)("div",{className:"text-center py-8 text-slate-500 dark:text-gray-400",children:(0,s.jsx)("p",{children:"No models match the current filter criteria."})}):(0,s.jsx)("div",{className:"space-y-2",children:e.map((e=>{const l=i(e),o=(e=>{const r=t.find((t=>t.slot.slotIndex===e.slotIndex));return r?r.percentage:50})(e),d=e.iconFile.length>0?"http://127.0.0.1:18888/"+a+"/"+e.slotIndex+"/"+e.iconFile.split(/[\/\\]/).pop():"",c=(e=>{const t=e.charAt(0).toUpperCase(),r=e.split("").reduce(((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e),0),s=["#007bff","#28a745","#dc3545","#ffc107","#17a2b8","#6f42c1","#e83e8c","#fd7e14"],n=s[Math.abs(r)%s.length];return`data:image/svg+xml;base64,${btoa(`\n      <svg width="32" height="32" xmlns="http://www.w3.org/2000/svg">\n        <rect width="100%" height="100%" fill="${n}" rx="3.2"/>\n        <text x="50%" y="50%" font-family="Arial" font-size="12.8" \n              fill="#ffffff" text-anchor="middle" dy=".3em">${t}</text>\n      </svg>\n    `)}`})(e.name);return(0,s.jsxs)("div",{className:"p-3 rounded-lg border transition-all duration-150 "+(l?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-700":"bg-white dark:bg-gray-800 border-slate-200 dark:border-gray-700 hover:bg-slate-50 dark:hover:bg-gray-700/50 cursor-pointer"),onClick:()=>(e=>{i(e)||r(e)})(e),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("input",{type:"checkbox",checked:l,onChange:t=>{t.stopPropagation(),r(e)},className:E}),(0,s.jsx)("img",{src:d.length>0?d:c,alt:e.name,className:"w-8 h-8 rounded-md object-cover flex-shrink-0"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-slate-800 dark:text-gray-200",children:e.name||`Model ${e.slotIndex}`}),(0,s.jsxs)("div",{className:"text-xs text-slate-500 dark:text-gray-400",children:[e.embedder||"Unknown"," â€¢ ",e.samplingRate||"Unknown"," Hz â€¢ ",e.voiceChangerType||"RVC",e.version||"1"]})]})]}),l&&(0,s.jsxs)("div",{className:"text-sm font-medium text-blue-600 dark:text-blue-400 ml-2",children:[o,"%"]})]}),l&&(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("input",{type:"range",min:"0",max:"100",value:o,onChange:t=>n(e.slotIndex,Number(t.target.value)),className:M}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-slate-500 dark:text-gray-400 mt-1 relative",children:[(0,s.jsx)("span",{children:"0%"}),(0,s.jsx)("span",{className:"absolute left-1/2 transform -translate-x-1/2",children:"50%"}),(0,s.jsx)("span",{children:"100%"})]})]})]},e.slotIndex)}))}),t.length>0&&(0,s.jsxs)("div",{className:"pt-3 border-t border-slate-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"text-sm text-slate-600 dark:text-gray-400",children:["Selected models: ",t.length]}),(0,s.jsxs)("div",{className:"text-xs text-slate-500 dark:text-gray-500 mt-1",children:["Total weight: ",t.reduce(((e,t)=>e+t.percentage),0),"%"]})]})]})};const te=function({downloadModel:e,setDownloadModel:t,saveToMergeSlot:r,setSaveToMergeSlot:n,saveToEmptySlot:a,setSaveToEmptySlot:i,emptySlots:l}){return(0,s.jsxs)("div",{className:"space-y-4 p-4 bg-slate-50 dark:bg-gray-800/30 rounded-lg border border-slate-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h4",{className:"text-md font-medium text-slate-700 dark:text-gray-200",children:"Merge Options"}),(0,s.jsx)(p.g,{icon:b.dB,className:"h-4 w-4 text-slate-500 dark:text-gray-400"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("input",{type:"checkbox",id:"download-model",checked:e,onChange:e=>{return r=e.target.checked,void t(r);var r},className:E}),(0,s.jsx)("label",{htmlFor:"download-model",className:T,children:"Download merged model"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("input",{type:"checkbox",id:"save-merge-slot",checked:r,onChange:e=>{return t=e.target.checked,n(t),void(t&&i(!1));var t},className:E}),(0,s.jsx)("label",{htmlFor:"save-merge-slot",className:T,children:"Save to merge slot"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("input",{type:"checkbox",id:"save-empty-slot",checked:a,onChange:e=>{return t=e.target.checked,i(t),void(t&&n(!1));var t},disabled:0===l.length,className:E}),(0,s.jsx)("label",{htmlFor:"save-empty-slot",className:`${T} ${0===l.length?"text-slate-400 dark:text-gray-500":""}`,children:"Save to empty slot (auto-select first available)"})]}),0===l.length&&(0,s.jsx)("div",{className:"ml-6 text-xs text-slate-500 dark:text-gray-400",children:"No empty slots available"})]})]})]})};const re=function({guiState:e,showMerge:t,setShowMerge:r}){const n=h(),[i,l]=(0,a.useState)(4e4),[o,d]=(0,a.useState)("hubert_base"),[c,g]=(0,a.useState)(""),[u,x]=(0,a.useState)([]),[v,p]=(0,a.useState)(!0),[b,f]=(0,a.useState)(!1),[S,j]=(0,a.useState)(!1),y=()=>n.serverSetting.serverSetting.modelSlots?n.serverSetting.serverSetting.modelSlots.filter((e=>!e.name||0===e.name.length)):[],N=()=>{const e=y();return e.length>0?e[0]:null},k=()=>{r(!1),x([]),l(4e4),d("hubert_base"),g(""),p(!0),f(!1),j(!1)},C=n.serverSetting.serverSetting.modelSlots?n.serverSetting.serverSetting.modelSlots.filter((e=>!(!e.name||0===e.name.length||e.samplingRate&&e.samplingRate!==i||e.embedder&&e.embedder!==o||c&&!e.name.toLowerCase().includes(c.toLowerCase())))):[],w=y();return(0,s.jsx)(Y,{isOpen:t,onClose:k,title:"Merge Lab",closeOnOutsideClick:!1,primaryButton:{text:""+(n.serverSetting.isUploading?`Merging... (${n.serverSetting.uploadProgress.toFixed(1)}%)`:"Merge"),onClick:async()=>{try{if(v||S||b){let t=null;const r=u.filter((e=>e.percentage>0));await n.serverSetting.mergeModel({voiceChangerType:m.VoiceChangerType.RVC,command:"mix",files:r.map((e=>({slotIndex:e.slot.slotIndex,strength:e.percentage/100})))}),e.showError("Models merged successfully!","Confirm");const s=await fetch("http://127.0.0.1:18888/tmp/merged.pth");if(t=await s.blob(),v){const r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download="merged.pth",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r),e.showError("Models downloaded successfully!","Confirm")}if(S||b){let r=S?N():499;if(S&&!r)return void e.showError("No empty slots available for saving.","Error");const s=new File([t],"merged.pth",{type:"application/octet-stream"}),a={voiceChangerType:m.VoiceChangerType.RVC,slot:S?N()?.slotIndex:499,files:[{kind:"rvcModel",file:s,dir:""}],isSampleMode:!1,sampleId:null,params:{},embedder:o};await n.serverSetting.uploadModel(a),e.showError("Models uploaded successfully!","Confirm"),k()}}else e.showError("No action selected. Please select at least one action.","Error")}catch(t){e.showError(`Error merging models: ${t instanceof Error?t.message:String(t)}`,"Error")}},disabled:0===u.length||n.serverSetting.isUploading,className:U},secondaryButton:{text:"Close",onClick:k,className:z,disabled:n.serverSetting.isUploading},children:(0,s.jsxs)("div",{className:"space-y-6 max-h-[60vh] overflow-y-auto pr-2",children:[(0,s.jsx)(Z,{sampleRate:i,setSampleRate:l,embedder:o,setEmbedder:d,searchText:c,setSearchText:g,onFilterChange:()=>{x([])}}),(0,s.jsx)(te,{downloadModel:v,setDownloadModel:p,saveToMergeSlot:b,setSaveToMergeSlot:f,saveToEmptySlot:S,setSaveToEmptySlot:j,emptySlots:w}),(0,s.jsx)(ee,{models:C,selectedModels:u,onModelToggle:e=>{const t=u.some((t=>t.slot.slotIndex===e.slotIndex));x(t?u.filter((t=>t.slot.slotIndex!==e.slotIndex)):[...u,{slot:e,percentage:50}])},onPercentageChange:(e,t)=>{x(u.map((r=>r.slot.slotIndex===e?{...r,percentage:t}:r)))},modelDir:n.serverSetting.serverSetting.voiceChangerParams.model_dir})]})})};const se=function({openModal:e}){const{theme:t,toggleTheme:r}=g(),n=h(),i=N(),[l,o]=(0,a.useState)(!1),[d,c]=(0,a.useState)(!1);(0,a.useEffect)((()=>{d&&(i.setIsConverting(!0),n.start())}),[d]);const u=async()=>{if(-1!==n.serverSetting.serverSetting.modelSlotIndex)if(0==n.serverSetting.serverSetting.enableServerAudio){if(!n.setting.voiceChangerClientSetting.audioInput||"none"==n.setting.voiceChangerClientSetting.audioInput)return void i.showError("Select an audio input device.","Warning");if("none"==i.audioOutputForGUI)return void i.showError("Select an audio output device.","Warning");if(n.initializedRef.current)i.setIsConverting(!0),await n.start();else{for(;await new Promise((e=>{setTimeout(e,500)})),!n.initializedRef.current;);c(!0)}}else{if(-1==n.serverSetting.serverSetting.serverInputDeviceId)return void i.showError("Select an audio input device.","Warning");if(-1==n.serverSetting.serverSetting.serverOutputDeviceId)return void i.showError("Select an audio output device.","Warning");n.serverSetting.updateServerSettings({...n.serverSetting.serverSetting,serverAudioStated:1}),i.setIsConverting(!0)}else i.showError("Select a voice model first.","Warning")},m=async()=>{0==n.serverSetting.serverSetting.enableServerAudio?(i.setIsConverting(!1),await n.stop()):(i.setIsConverting(!1),n.serverSetting.updateServerSettings({...n.serverSetting.serverSetting,serverAudioStated:0}))},x="text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-gray-800 transition-all duration-150 flex items-center justify-center space-x-2 shadow-sm",v="px-3 py-2 text-slate-700 bg-slate-200 hover:bg-slate-300 dark:text-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 focus:ring-blue-500";return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(re,{guiState:i,showMerge:l,setShowMerge:o}),(0,s.jsxs)("div",{className:"h-20 min-h-[60px] bg-white dark:bg-gray-800 border-t border-slate-200 dark:border-gray-700 flex items-center justify-between px-4 py-2 flex-shrink-0 transition-colors duration-300",children:[(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>o(!0),className:`${x} ${v}`,children:"Merge Lab"}),(0,s.jsx)("button",{onClick:()=>e("advancedSettings"),className:`${x} ${v}`,children:"Advanced Settings"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("button",{onClick:async()=>{i.isConverting?m():u()},className:`px-4 py-2 rounded-md text-sm font-medium transition-colors duration-150 flex items-center space-x-2 \n            ${i.isConverting?"bg-red-500 hover:bg-red-600 text-white":"bg-green-500 hover:bg-green-600 text-white"}\n            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 \n            ${i.isConverting?"focus:ring-red-400":"focus:ring-green-400"}`,children:[(0,s.jsx)(p.g,{icon:i.isConverting?b.APi:b.ijD}),(0,s.jsx)("span",{children:i.isConverting?"Stop Server":"Start Server"})]}),(0,s.jsxs)("button",{onClick:()=>{const t=!0===n.setting?.voiceChangerClientSetting?.passThroughConfirmationSkip;n.serverSetting?.serverSetting?.passThrough?n.serverSetting.updateServerSettings({...n.serverSetting.serverSetting,passThrough:!1}):t?n.serverSetting.updateServerSettings({...n.serverSetting.serverSetting,passThrough:!0}):e("passThrough",{title:"Activate Passthrough?",message:"Activating passthrough will output your input voice directly without any changes.",icon:b.JAe,iconClassName:"text-yellow-500 w-12 h-12 mx-auto mb-4",confirmText:"Activate Passthrough",cancelText:"Cancel",onConfirm:()=>{n.serverSetting.updateServerSettings({...n.serverSetting.serverSetting,passThrough:!0})}})},className:`px-4 py-2 rounded-md text-sm font-medium transition-colors duration-150 flex items-center space-x-2 \n            ${n.serverSetting?.serverSetting?.passThrough?"bg-yellow-500 hover:bg-yellow-600 text-gray-900":"bg-gray-600 hover:bg-gray-500 text-white"}\n            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 \n            ${n.serverSetting?.serverSetting?.passThrough?"focus:ring-yellow-400":"focus:ring-gray-400"}`,children:[(0,s.jsx)(p.g,{icon:n.serverSetting?.serverSetting?.passThrough?b.jY_:b.PKk}),(0,s.jsx)("span",{children:n.serverSetting?.serverSetting?.passThrough?"Passthrough ON":"Passthrough OFF"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>e("serverInfo"),className:`${x} ${v}`,children:"Server Info"}),(0,s.jsx)("button",{onClick:()=>e("clientInfo"),className:`${x} ${v}`,children:"Client Info"}),(0,s.jsx)("button",{onClick:r,className:`${x} ${v} w-10 h-10`,"aria-label":"light"===t?"Switch to dark mode":"Switch to light mode",children:(0,s.jsx)(p.g,{icon:"light"===t?b.PJS:b.oMq,className:"h-5 w-5"})})]})]})]})},ne=({value:e,onChange:t,onImmediateChange:r,...n})=>{const[i,l]=(0,a.useState)(e);(0,a.useEffect)((()=>{l(e)}),[e]);const o=((e,t)=>{const r=(0,a.useRef)(),s=(0,a.useCallback)(((...s)=>{window.clearTimeout(r.current),r.current=window.setTimeout((()=>{e(...s)}),t)}),[e,t]);return(0,a.useEffect)((()=>()=>{window.clearTimeout(r.current)}),[]),s})((e=>{t(e)}),300);return(0,s.jsx)("input",{type:"range",...n,value:i,onChange:e=>{const t=e.target.valueAsNumber;l(t),r&&r(t),o(t)}})};const ae=function(){const e=h(),t=N(),[r,n]=(0,a.useState)(e.serverSetting?.serverSetting?.crossFadeOverlapSize??.02),[i,l]=(0,a.useState)(e.serverSetting?.serverSetting?.protect??0);(0,a.useEffect)((()=>{const t=e.serverSetting?.serverSetting?.crossFadeOverlapSize;null!=t&&n(t);const r=e.serverSetting?.serverSetting?.protect;null!=r&&l(r)}),[e.serverSetting?.serverSetting]);const o="block text-sm font-medium text-slate-600 dark:text-gray-400 mb-1",d="w-full p-2 border border-slate-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-700 text-slate-900 dark:text-gray-100 text-sm transition-colors duration-150",c="w-full h-2 bg-slate-200 dark:bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-500 dark:accent-blue-400 transition-colors duration-150",g="inline-flex items-center text-sm text-slate-700 dark:text-gray-300";return(0,s.jsxs)("div",{className:"space-y-4 py-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"uiLanguage",className:o,children:"UI Language"}),(0,s.jsxs)("select",{id:"uiLanguage",className:d,value:e.setting?.uiLanguage||"en",onChange:e=>{},children:[(0,s.jsx)("option",{value:"en",children:"ðŸ‡¬ðŸ‡§ English"}),(0,s.jsx)("option",{value:"de",children:"ðŸ‡©ðŸ‡ª Deutsch"}),(0,s.jsx)("option",{value:"ja",children:"ðŸ‡¯ðŸ‡µ æ—¥æœ¬èªž"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"protocol",className:o,children:"Protocol"}),(0,s.jsxs)("select",{id:"protocol",className:d,value:e.setting.workletNodeSetting.protocol,onChange:t=>e.setWorkletNodeSetting({...e.setting.workletNodeSetting,protocol:t.target.value}),children:[(0,s.jsx)("option",{value:"sio",children:"sio"}),(0,s.jsx)("option",{value:"rest",children:"rest"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"crossfade",className:o,children:"Crossfade Overlap"}),(0,s.jsx)(ne,{id:"crossfade",name:"crossfade",min:.05,max:.2,step:.01,value:r,className:c,onImmediateChange:n,onChange:async t=>{await e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,crossFadeOverlapSize:t})}}),(0,s.jsxs)("p",{className:"text-xs text-slate-600 dark:text-gray-400 text-right",children:[r.toFixed(2)," s"]})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:g,children:[(0,s.jsx)("input",{type:"checkbox",className:"mr-2 accent-blue-500 dark:accent-blue-400",checked:1===e.serverSetting.serverSetting.silenceFront,onChange:async r=>{const s=r.target.checked?1:0;t.startLoading((1===s?"Enabling":"Disabling")+" Silence Front"),await e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,silenceFront:s}),t.stopLoading()}}),"Silence Front"]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:g,children:[(0,s.jsx)("input",{type:"checkbox",className:"mr-2 accent-blue-500 dark:accent-blue-400",checked:1===e.serverSetting.serverSetting.forceFp32,onChange:async r=>{const s=r.target.checked?1:0;t.startLoading((1===s?"Enabling":"Disabling")+" Force FP32 Mode"),await e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,forceFp32:s}),t.stopLoading()}}),"Force FP32 Mode"]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:g,children:[(0,s.jsx)("input",{type:"checkbox",className:"mr-2 accent-blue-500 dark:accent-blue-400",checked:1===e.serverSetting.serverSetting.disableJit,onChange:async r=>{const s=r.target.checked?1:0;t.startLoading((1===s?"Disabling":"Enabling")+" JIT Compilation"),await e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,disableJit:s}),t.stopLoading()}}),"Disable JIT Compilation"]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:g,children:[(0,s.jsx)("input",{type:"checkbox",className:"mr-2 accent-blue-500 dark:accent-blue-400",checked:1===e.serverSetting.serverSetting.useONNX,onChange:async r=>{const s=r.target.checked?1:0;t.startLoading((1===s?"Enabling":"Disabling")+" Convert to ONNX"),await e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,useONNX:s}),t.stopLoading()}}),"Convert to ONNX"]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"protect",className:o,children:"Protect"}),(0,s.jsx)(ne,{id:"protect",name:"protect",min:0,max:.5,step:.01,value:i,className:c,onImmediateChange:l,onChange:async t=>{await e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,protect:t})}}),(0,s.jsx)("p",{className:"text-xs text-slate-600 dark:text-gray-400 text-right",children:i.toFixed(2)})]}),(0,s.jsxs)("div",{className:"border border-red-500 p-3 rounded bg-red-50 dark:bg-red-900/20 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center text-red-600 mb-2",children:[(0,s.jsx)(p.g,{icon:b.zpE,className:"mr-2"}),(0,s.jsx)("span",{className:"font-semibold",children:"Danger Zone"})]}),(0,s.jsxs)("label",{className:g,children:[(0,s.jsx)("input",{type:"checkbox",className:"mr-2 accent-red-500 dark:accent-red-400",checked:e.setting.voiceChangerClientSetting.passThroughConfirmationSkip,onChange:t=>e.setVoiceChangerClientSetting({...e.setting.voiceChangerClientSetting,passThroughConfirmationSkip:t.target.checked})}),"Skip Pass through confirmation"]})]})]})};const ie=function(){const e=h(),t=JSON.stringify(e.serverSetting.serverSetting,null,2);return(0,s.jsx)("div",{className:"bg-slate-100 dark:bg-slate-800 p-3 rounded-lg shadow-inner",children:(0,s.jsx)("pre",{className:"text-xs text-slate-700 dark:text-gray-300 overflow-auto max-h-[60vh] custom-scrollbar p-2 rounded-md bg-white dark:bg-slate-900",children:(0,s.jsx)("code",{children:t})})})};const le=function(){const e=h(),t=JSON.stringify(e.setting,null,2);return(0,s.jsx)("div",{className:"bg-slate-100 dark:bg-slate-800 p-3 rounded-lg shadow-inner",children:(0,s.jsx)("pre",{className:"text-xs text-slate-700 dark:text-gray-300 overflow-auto max-h-[60vh] custom-scrollbar p-2 rounded-md bg-white dark:bg-slate-900",children:(0,s.jsx)("code",{children:t})})})};const oe=function({modelId:e,modelName:t}){return(0,s.jsx)("div",{children:(0,s.jsxs)("p",{className:"text-sm text-slate-600 dark:text-gray-300",children:["Edit model content for ",t||"model"," (ID: ",e||"N/A",") goes here. Allow modification of model name, parameters, etc."]})})};const de=function({modelId:e,modelName:t}){return(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm text-slate-600 dark:text-gray-300",children:['Are you sure you want to delete the model "',t||"this model",'" (ID: ',e||"N/A",")?"]}),(0,s.jsx)("p",{className:"text-xs text-red-500 dark:text-red-400 mt-2",children:"This action cannot be undone."})]})},ce=({title:e="Confirm Action",message:t="Are you sure you want to proceed?",icon:r,iconClassName:n="text-yellow-500 w-12 h-12 mx-auto mb-4",confirmText:a="Confirm",onConfirm:i,onCancel:l,closeModal:o})=>(0,s.jsxs)("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md mx-auto",children:[r&&(0,s.jsx)("div",{className:"flex justify-center mb-4",children:(0,s.jsx)(p.g,{icon:r,className:`${n} text-4xl`})}),(0,s.jsx)("h3",{className:"text-xl font-semibold text-center text-gray-900 dark:text-white mb-3",children:e}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 text-center mb-6",children:t}),(0,s.jsx)("div",{className:"flex justify-center space-x-3",children:(0,s.jsx)("button",{onClick:()=>{i&&i(),o()},className:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 dark:focus:ring-offset-gray-900 transition-colors duration-150",children:a})})]});var ge=r(3375),ue=r(3627),me=r(4979);const xe=({id:e,children:t})=>{const{attributes:r,listeners:n,setNodeRef:a,transform:i,transition:l,isDragging:o}=(0,ue.gl)({id:e}),d={transform:me.Ks.Transform.toString(i),transition:l,opacity:o?.5:1,display:"flex"};return(0,s.jsxs)("div",{ref:a,style:d,className:"flex",children:[" ",t(r,n??{})]})},he=({attributes:e,listeners:t,className:r,title:n="Drag"})=>(0,s.jsx)("button",{...e,...t,className:`p-1 text-slate-500 hover:text-slate-700 dark:text-gray-400 dark:hover:text-gray-200 cursor-grab ${r}`,title:n,children:(0,s.jsx)(p.g,{icon:b.TFt,className:"h-5 w-5"})});const ve=function({model:e,openModal:t,icon:r}){const n=(e?.isONNX??!1)&&e?.modelTypeOnnx||e?.modelType;return(0,s.jsx)(s.Fragment,{children:e?(0,s.jsx)("div",{className:"flex flex-col items-center text-center mb-6 p-4 bg-slate-50 dark:bg-gray-700/30 rounded-lg",children:(0,s.jsxs)("div",{className:"flex w-full items-start",children:[(0,s.jsx)("img",{src:r,alt:e.name,className:"w-28 h-28 md:w-32 md:h-32 rounded-full object-cover border-4 border-white dark:border-gray-600 shadow-lg mb-3 mr-4 flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-grow text-left",children:[(0,s.jsxs)("div",{className:"flex items-center mb-1",children:[(0,s.jsx)("h3",{className:"text-xl lg:text-2xl font-bold text-slate-800 dark:text-gray-100 break-words mr-2",children:e.name}),(0,s.jsx)("button",{onClick:()=>t("editModel",{model:e}),className:"p-1 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-full",title:"Edit Model",children:(0,s.jsx)(p.g,{icon:b.hpd,className:"h-4 w-4"})})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"text-xs text-slate-600 dark:text-gray-400",children:[(0,s.jsx)("span",{className:"font-semibold",children:"Embedder:"})," ",e.embedder||"N/A"]}),(0,s.jsxs)("div",{className:"text-xs text-slate-600 dark:text-gray-400",children:[(0,s.jsx)("span",{className:"font-semibold",children:"Model Type:"})," ",n||"N/A"]}),(0,s.jsxs)("div",{className:"text-xs text-slate-600 dark:text-gray-400",children:[(0,s.jsx)("span",{className:"font-semibold",children:"Sample Rate:"})," ",e.samplingRate?e.samplingRate/1e3+" kHz":"N/A"]})]})]})]})}):(0,s.jsx)("div",{className:"flex items-center justify-center mb-6 p-8 bg-slate-100 dark:bg-gray-700/50 rounded-lg min-h-[160px]",children:(0,s.jsxs)("p",{className:"text-slate-500 dark:text-gray-400 italic text-center",children:["Select a model from the list ",(0,s.jsx)("br",{})," to see its settings."]})})})};const pe=function({model:e,handlePitchChange:t,handleFormatShiftChange:r,handleIndexRatioChange:n,handleSpeakerChange:a,setModel:i}){let l=[];return l=e&&e.speakers&&Object.keys(e.speakers).length>0?Object.entries(e.speakers).map((([e,t])=>(0,s.jsx)("option",{value:e,children:t},e))):[(0,s.jsx)("option",{value:0,disabled:!0,children:"No speakers"},"no-speakers")],(0,s.jsxs)("div",{className:"space-y-4 "+(e?"":"opacity-50 pointer-events-none"),children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"pitch",className:T,children:"Pitch:"}),(0,s.jsx)(ne,{id:"pitch",name:"pitch",min:-50,max:50,step:1,value:e?.defaultTune||0,onChange:t,onImmediateChange:t=>i({...e,defaultTune:t}),className:M,disabled:!e}),(0,s.jsx)("p",{className:O,children:e?.defaultTune||0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"formatShift",className:T,children:"Formant Shift:"}),(0,s.jsx)(ne,{id:"formatShift",name:"formatShift",min:-5,max:5,step:.1,value:e?.defaultFormantShift??0,onChange:r,onImmediateChange:t=>i({...e,defaultFormantShift:t}),className:M,disabled:!e}),(0,s.jsx)("p",{className:O,children:(e?.defaultFormantShift??0).toFixed(1)})]}),""!==e.indexFile&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"indexRatio",className:T,children:"Index Ratio:"}),(0,s.jsx)(ne,{id:"indexRatio",name:"indexRatio",min:0,max:1,step:.01,value:e?.defaultIndexRatio??.5,onChange:n,onImmediateChange:t=>i({...e,defaultIndexRatio:t}),className:M,disabled:!e}),(0,s.jsx)("p",{className:O,children:(e?.defaultIndexRatio??.5).toFixed(2)})]}),e.speakers&&Object.keys(e.speakers).length>1&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("label",{htmlFor:"speaker",className:T,children:"Speaker:"}),(0,s.jsx)("select",{id:"speaker",name:"speaker",className:I,disabled:!e||!e.speakers||0===Object.keys(e.speakers).length,value:e?.slotIndex??0,onChange:e=>a(Number(e.target.value)),children:l})]})]})};const be=function({openModal:e,dndAttributes:t,dndListeners:r}){const n=h(),[i,l]=(0,a.useState)(!1),[o,d]=(0,a.useState)();(0,a.useEffect)((()=>{d(n.serverSetting.serverSetting.modelSlots[n.serverSetting.serverSetting.modelSlotIndex])}),[n.serverSetting?.serverSetting.modelSlotIndex,n.serverSetting?.serverSetting.voiceChangerParams.model_dir]);const c=n.serverSetting.serverSetting.voiceChangerParams.model_dir,g=o?.iconFile&&o?.iconFile.length>0?"http://127.0.0.1:18888/"+c+"/"+o.slotIndex+"/"+o.iconFile.split(/[\/\\]/).pop():"",u=k(o?.name||"");return(0,s.jsxs)("div",{className:"p-4 border border-slate-200 dark:border-gray-700 rounded-md shadow-sm bg-white dark:bg-gray-800 transition-all duration-300 flex-1 min-h-0 flex flex-col "+(i?"h-auto":""),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-slate-200 dark:border-gray-700",children:[(0,s.jsx)("h4",{className:"text-lg font-semibold text-slate-800 dark:text-gray-200",children:"Model Settings"}),(0,s.jsxs)("div",{className:"flex space-x-1 items-center",children:[(0,s.jsx)("button",{onClick:()=>l(!i),className:`${L} focus:ring-blue-500`,title:i?"Expand":"Collapse",children:(0,s.jsx)(p.g,{icon:i?b.Jt$:b.w2A,className:"h-5 w-5"})}),(0,s.jsx)(he,{attributes:t,listeners:r,title:"Drag"})]})]}),!i&&(0,s.jsxs)(s.Fragment,{children:[o?(0,s.jsx)(ve,{model:o,openModal:e,icon:g||u}):(0,s.jsx)("div",{className:"flex items-center justify-center mb-6 p-8 bg-slate-100 dark:bg-gray-700/50 rounded-lg min-h-[160px]",children:(0,s.jsxs)("p",{className:"text-slate-500 dark:text-gray-400 italic text-center",children:["Select a model from the list ",(0,s.jsx)("br",{})," to see its settings."]})}),o&&(0,s.jsx)(pe,{model:o,handlePitchChange:e=>{n.serverSetting.updateServerSettings({...n.serverSetting.serverSetting,tran:e})},handleFormatShiftChange:e=>{n.serverSetting.updateServerSettings({...n.serverSetting.serverSetting,formantShift:e})},handleIndexRatioChange:e=>{n.serverSetting.updateServerSettings({...n.serverSetting.serverSetting,indexRatio:e})},handleSpeakerChange:e=>{n.serverSetting.updateServerSettings({...n.serverSetting.serverSetting,dstId:e})},setModel:d})]}),(0,s.jsx)("div",{className:"flex justify-end mt-4",children:(0,s.jsx)("button",{onClick:()=>{n.serverSetting.updateModelDefault()},className:z,children:"Save Settings"})})]})};var fe=r(4653),Se=r(6631),je=r(9107),ye=r(7984),Ne=r(3495),ke=r(8687),Ce=r(7018),we=r(4124),Ie=r(6279);const Ae=({active:e,payload:t,label:r})=>{if(e&&t&&t.length){const e=t.find((e=>"perfTimeValue"===e.dataKey));if(e)return(0,s.jsxs)("div",{className:"bg-slate-800 border border-slate-600 rounded-md p-2 shadow-lg",children:[(0,s.jsx)("p",{className:"text-slate-200 text-sm mb-1",children:`Time: ${new Date(r).toLocaleTimeString()}`}),(0,s.jsx)("p",{className:"text-slate-300 text-sm",children:`Main Process Time: ${Math.round(e.value)} ms`})]})}return null},Me={good:"text-green-600 dark:text-green-400",warning:"text-yellow-600 dark:text-yellow-400",critical:"text-red-600 dark:text-red-400"},Fe="#10B981",Ee="#F59E0B",De="#EF4444",Te=.01,$e=0,Oe=0;const Re=function({dndAttributes:e,dndListeners:t}){const r=g(),n=h(),[i,l]=(0,a.useState)(!1),o=(0,a.useMemo)((()=>({vol:n.inputVolume??Te,responseTime:n.responseTime??$e,mainprocessTime:n.mainprocessTime??Oe})),[n]),[d,c]=(0,a.useState)([]),[u,m]=(0,a.useState)(50),[x,v]=(0,a.useState)(!1),[f,S]=(0,a.useState)([]),j=(0,a.useMemo)((()=>{const e=Math.max(Math.round(20*Math.log10(n.performance.vol||1e-5)),-90),t=128*n.serverSetting.serverSetting.serverReadChunkSize*1e3/48e3,r=Math.ceil(t+n.performance.responseTime+1e3*n.serverSetting.serverSetting.crossFadeOverlapSize);let s="good";const a=.8*t;return n.performance.mainprocessTime>t?s="critical":n.performance.mainprocessTime>a&&(s="warning"),{volumeDb:e,ping:n.performance.responseTime,totalLatencyTime:r,perfTime:n.performance.mainprocessTime,chunkTime:t,perfStatus:s}}),[o,n.serverSetting.serverSetting]);(0,a.useEffect)((()=>{const{perfStatus:e,perfTime:t}=j,r=Math.round(t);let s=0,n=0,a=0;"good"===e?s=r:"warning"===e?n=r:"critical"===e&&(a=r);const i={timestamp:Date.now(),perfTimeValue:r,greenTime:s,yellowTime:n,redTime:a};c((e=>{const t=[...e,i];return t.length>u?t.slice(t.length-u):t})),x&&S((e=>[...e,{timestamp:i.timestamp,...j,perfValueString:`${Math.round(j.totalLatencyTime)}ms of ${Math.round(j.chunkTime)}ms`}]))}),[j,u,x]);const y={Vol:{value:j.volumeDb,unit:"dB"},Ping:{value:Math.round(j.ping),unit:"ms"},Total:{value:Math.round(j.totalLatencyTime),unit:"ms"},Perf:{value:`${Math.round(j.perfTime)}ms of ${Math.round(j.chunkTime)}ms`,className:Me[j.perfStatus]}},N=(0,a.useCallback)((()=>{if(0===f.length)return;const e=f.map((e=>`${e.timestamp},${new Date(e.timestamp).toISOString()},${e.volumeDb},${Math.round(e.ping)},${Math.round(e.totalLatencyTime)},${Math.round(e.perfTime)},${Math.round(e.chunkTime)},${e.perfStatus}`)).join("\n"),t=new Blob(["Timestamp,DateTime,Volume_dB,Ping_ms,TotalLatency_ms,PerfValue_ms,PerfChunk_ms,PerfStatus\n"+e],{type:"text/csv;charset=utf-8"}),r=document.createElement("a");r.href=URL.createObjectURL(t),r.download=`performance_log_${(new Date).toISOString().replace(/[:.]/g,"-")}.csv`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href),S([])}),[f]);return(0,s.jsxs)("div",{className:"p-4 border border-slate-200 dark:border-gray-700 rounded-md shadow-sm bg-white dark:bg-gray-800 transition-all duration-300 flex-1 min-h-0 flex flex-col "+(i?"h-auto":""),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-slate-200 dark:border-gray-700",children:[(0,s.jsx)("h5",{className:"text-lg font-semibold text-slate-700 dark:text-gray-200",children:"Performance Stats"}),(0,s.jsxs)("div",{className:"flex space-x-1 items-center",children:[(0,s.jsx)("button",{onClick:()=>l(!i),className:"p-1 text-slate-500 hover:text-slate-700 dark:text-gray-400 dark:hover:text-gray-200",title:i?"Expand":"Collapse",children:(0,s.jsx)(p.g,{icon:i?b.Jt$:b.w2A,className:"h-5 w-5"})}),(0,s.jsx)(he,{attributes:e,listeners:t,title:"Drag"})]})]}),!i&&(0,s.jsxs)("div",{className:"flex-grow flex flex-col items-center",children:[(0,s.jsx)("div",{className:"flex justify-around w-full mb-3",children:["Vol","Ping","Total","Perf"].map((e=>{const t=y[e];return(0,s.jsxs)("span",{className:"text-xs font-medium text-slate-600 dark:text-gray-400",children:[e,":"," ",(0,s.jsxs)("span",{className:`text-slate-800 dark:text-gray-200 ${t.className||""}`,children:[t.value,t.unit||""]})]},e)}))}),(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2 w-full px-1",children:[(0,s.jsxs)("button",{onClick:()=>{x&&N(),v(!x)},className:"px-2 py-1 text-xs rounded flex items-center space-x-1.5 transition-colors duration-150 "+(x?"bg-red-500 hover:bg-red-600 text-white":"bg-green-500 hover:bg-green-600 text-white dark:bg-green-600 dark:hover:bg-green-700"),title:x?"Stop Recording & Download CSV":"Start Recording Performance Log",children:[(0,s.jsx)(p.g,{icon:x?b.SG1:b.e74,className:"h-3 w-3"}),(0,s.jsx)("span",{children:x?"Stop":"Record"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"text-xs text-slate-500 dark:text-gray-400 self-center",children:"History:"}),[20,50,100].map((e=>(0,s.jsx)("button",{onClick:()=>m(e),className:"px-2 py-0.5 text-xs rounded "+(u===e?"bg-blue-600 text-white dark:bg-blue-500":"bg-slate-200 dark:bg-gray-600 hover:bg-slate-300 dark:hover:bg-gray-500 text-slate-700 dark:text-gray-200"),children:e},e)))]})]}),(0,s.jsx)("div",{className:"w-full h-48 bg-slate-100 dark:bg-gray-700 border border-slate-300 dark:border-gray-500 rounded-md flex-grow",children:(0,s.jsx)(fe.u,{width:"100%",height:"100%",children:(0,s.jsxs)(Se.X,{data:d,children:[(0,s.jsx)(je.d,{strokeDasharray:"3 3",strokeOpacity:.2}),(0,s.jsx)(ye.W,{dataKey:"timestamp",tickFormatter:e=>new Date(e).toLocaleTimeString(),stroke:"#94a3b8",tick:{fontSize:10}}),(0,s.jsx)(Ne.h,{label:{value:"ms",angle:-90,position:"insideLeft",fill:"#94a3b8",fontSize:12},stroke:"#94a3b8",tick:{fontSize:10},tickFormatter:e=>String(Math.round(e))}),(0,s.jsx)(ke.m,{content:(0,s.jsx)(Ae,{})}),(0,s.jsx)(Ce.s,{wrapperStyle:{fontSize:"12px",paddingTop:"10px"}}),(0,s.jsx)(we.G,{type:"monotone",dataKey:"greenTime",stroke:"none",fill:Fe,stackId:"perfArea",fillOpacity:.4,name:"",legendType:"none"}),(0,s.jsx)(we.G,{type:"monotone",dataKey:"yellowTime",stroke:"none",fill:Ee,stackId:"perfArea",fillOpacity:.4,name:"",legendType:"none"}),(0,s.jsx)(we.G,{type:"monotone",dataKey:"redTime",stroke:"none",fill:De,stackId:"perfArea",fillOpacity:.4,name:"",legendType:"none"}),(0,s.jsx)(Ie.N,{type:"monotone",dataKey:"perfTimeValue",stroke:"dark"===r.theme?"#cbd5e1":"#475569",strokeWidth:2,dot:!1,name:"Main Process Time"})]})})})]})]})},Pe=["crepe_full_onnx","crepe_tiny_onnx","crepe_full","crepe_tiny","rmvpe","rmvpe_onnx","fcpe","fcpe_onnx"];const Le=function({dndAttributes:e,dndListeners:t}){const r=h(),n=N(),{appGuiSettingState:i}=d(),l=i.edition,[o,c]=(0,a.useState)(!1),{getItem:g,setItem:u}=(0,m.useIndexedDB)({clientType:null}),[x,v]=(0,a.useState)(r.serverSetting?.serverSetting?.silentThreshold??-75),[f,S]=(0,a.useState)(r.serverSetting?.serverSetting?.serverReadChunkSize?r.serverSetting.serverSetting.serverReadChunkSize:5),[j,y]=(0,a.useState)(r.serverSetting?.serverSetting?.extraConvertSize??1);return(0,a.useEffect)((()=>{const e=r.serverSetting?.serverSetting?.silentThreshold;v(e)}),[r.serverSetting?.serverSetting?.silentThreshold]),(0,a.useEffect)((()=>{const e=r.serverSetting?.serverSetting?.serverReadChunkSize;S(e)}),[r.serverSetting?.serverSetting?.serverReadChunkSize]),(0,a.useEffect)((()=>{const e=r.serverSetting?.serverSetting?.extraConvertSize;y(e)}),[r.serverSetting?.serverSetting?.extraConvertSize]),(0,a.useEffect)((()=>{(async()=>{const e=await g(K);e&&r.setVoiceChangerClientSetting({...r.setting.voiceChangerClientSetting,echoCancel:e});const t=await g(V);t&&r.setVoiceChangerClientSetting({...r.setting.voiceChangerClientSetting,noiseSuppression:t});const s=await g(W);s&&r.setVoiceChangerClientSetting({...r.setting.voiceChangerClientSetting,noiseSuppression2:s})})()}),[]),(0,s.jsxs)("div",{className:"p-4 border border-slate-200 dark:border-gray-700 rounded-md shadow-sm bg-white dark:bg-gray-800 transition-all duration-300 flex-1 min-h-0 flex flex-col "+(o?"h-auto":"overflow-y-auto"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-slate-200 dark:border-gray-700",children:[(0,s.jsx)("h4",{className:$,children:"AI Settings"}),(0,s.jsxs)("div",{className:"flex space-x-1 items-center",children:[(0,s.jsx)("button",{onClick:()=>c(!o),className:L,title:o?"Expand":"Collapse",children:(0,s.jsx)(p.g,{icon:o?b.Jt$:b.w2A,className:"h-5 w-5"})}),(0,s.jsx)(he,{attributes:e,listeners:t,title:"Drag"})]})]}),!o&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:T,children:"Noise Reduction:"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("label",{className:R,children:[(0,s.jsx)("input",{type:"checkbox",name:"echoCancel",className:E,checked:r.setting.voiceChangerClientSetting.echoCancel??!1,onChange:e=>{return t=e.target.checked,r.setVoiceChangerClientSetting({...r.setting.voiceChangerClientSetting,echoCancel:t}),void u(K,t);var t},disabled:1===r.serverSetting.serverSetting.enableServerAudio})," Echo Cancellation"]}),(0,s.jsxs)("label",{className:R,children:[(0,s.jsx)("input",{type:"checkbox",name:"noiseSuppression",className:E,checked:r.setting.voiceChangerClientSetting.noiseSuppression??!1,onChange:e=>{return t=e.target.checked,r.setVoiceChangerClientSetting({...r.setting.voiceChangerClientSetting,noiseSuppression:t}),void u(V,t);var t},disabled:1===r.serverSetting.serverSetting.enableServerAudio})," Noise Suppression"]}),(0,s.jsxs)("label",{className:R,children:[(0,s.jsx)("input",{type:"checkbox",name:"noiseSuppression2",className:E,checked:r.setting.voiceChangerClientSetting.noiseSuppression2??!1,onChange:e=>{return t=e.target.checked,r.setVoiceChangerClientSetting({...r.setting.voiceChangerClientSetting,noiseSuppression2:t}),void u(W,t);var t},disabled:1===r.serverSetting.serverSetting.enableServerAudio})," Noise Suppression 2"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"inSens",className:T,children:"Input Sensitivity (In. Sens):"}),(0,s.jsx)(ne,{id:"inSens",name:"inSens",min:-90,max:-60,step:1,value:x,className:M,onImmediateChange:v,onChange:e=>{v(e),r.serverSetting.updateServerSettings({...r.serverSetting?.serverSetting,silentThreshold:e})}}),(0,s.jsxs)("p",{className:O,children:[x," dB"]})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"chunk",className:T,children:"Chunk Size:"}),(0,s.jsx)(ne,{id:"chunk",name:"chunk",min:1,max:1024,step:1,value:f,className:`${M} ${n.isConverting?F:""}`,onImmediateChange:S,onChange:e=>{S(e),r.setWorkletNodeSetting({...r.setting.workletNodeSetting,inputChunkNum:Number(e)}),r.trancateBuffer(),r.serverSetting.updateServerSettings({...r.serverSetting?.serverSetting,serverReadChunkSize:e})},disabled:n.isConverting}),(0,s.jsxs)("p",{className:O,children:[(128*f*1e3/48e3).toFixed(1),"ms"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"extra",className:T,children:"Extra Processing Time (Extra):"}),(0,s.jsx)(ne,{id:"extra",name:"extra",min:0,max:5,step:.1,value:j,className:`${M} ${n.isConverting?F:""}`,onImmediateChange:y,onChange:e=>{y(e),r.serverSetting.updateServerSettings({...r.serverSetting?.serverSetting,extraConvertSize:e})},disabled:n.isConverting}),(0,s.jsxs)("p",{className:O,children:[j," s"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"gpu",className:T,children:"Processing Unit (GPU):"}),(0,s.jsx)("select",{id:"gpu",name:"gpu",className:I,value:r.serverSetting?.serverSetting?.gpu??-1,onChange:async e=>{n.startLoading(`Changing to Processing Unit: ${r.serverSetting?.serverSetting?.gpus?.find((t=>t.id===parseInt(e.target.value)))?.name}`),await(async e=>{await r.serverSetting.updateServerSettings({...r.serverSetting?.serverSetting,gpu:e})})(parseInt(e.target.value)),n.stopLoading()},children:r.serverSetting?.serverSetting?.gpus?.length&&r.serverSetting?.serverSetting?.gpus?.length>0?r.serverSetting?.serverSetting?.gpus?.map((e=>(0,s.jsx)("option",{value:e.id,children:`${e.name} ${e.memory?`(${(e.memory/1024/1024/1024).toFixed(0)} GB)`:""}`},e.id))):(0,s.jsx)("option",{value:"-1",disabled:!0,children:"No GPUs available"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"f0Detector",className:T,children:"Pitch Extraction Algorithm"}),(0,s.jsx)("select",{id:"f0Detector",className:I,value:r.serverSetting?.serverSetting?.f0Detector??"",disabled:n.isConverting,onChange:async e=>{n.startLoading(`Changing F0 Detector to ${e.target.value}`),await r.serverSetting.updateServerSettings({...r.serverSetting?.serverSetting,f0Detector:e.target.value}),n.stopLoading()},children:(()=>{if(l.indexOf("DirectML")>=0){const e=Pe.filter((e=>e.includes("_onnx")));return Object.values(r.serverSetting.serverSetting.voiceChangerParams).map((t=>e.includes(t)?(0,s.jsx)("option",{value:t,children:t},t):(0,s.jsxs)("option",{value:t,disabled:!0,children:[t,"(N/A)"]},t)))}return Object.values(Pe).map((e=>(0,s.jsx)("option",{value:e,children:e},e)))})()})]})]})]})]})};const Ue=function({audioState:e,setAudioState:t}){const r=h(),n=N(),[i,l]=(0,a.useState)(null),o=n?.inputAudioDeviceInfo?.length>0&&n?.outputAudioDeviceInfo?.length>0&&""!==n?.inputAudioDeviceInfo[0].deviceId&&""!==n?.outputAudioDeviceInfo[0].deviceId,d=r.serverSetting?.serverSetting?.serverAudioInputDevices,c=r.serverSetting?.serverSetting?.serverAudioOutputDevices,g=Array.isArray(d)&&d.length>0&&Array.isArray(c)&&c.length>0;return(0,a.useEffect)((()=>{let s=null;!o&&g?s="server":o&&!g&&(s="client"),s&&s!==e&&(t(s),"server"===s?r.serverSetting.updateServerSettings({...r.serverSetting.serverSetting,enableServerAudio:1}):r.serverSetting.updateServerSettings({...r.serverSetting.serverSetting,enableServerAudio:0}));const n=[];o||n.push("Client audio not available"),g||n.push("Server audio not available"),l(n.length>0?n.join(" and ")+".":null)}),[o,g,r.serverSetting,t,e]),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{className:"pb-2 border-b border-slate-200 dark:border-gray-700",children:[(0,s.jsxs)("div",{className:"flex items-center mb-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 dark:text-gray-300",children:"Audio Processing"}),i&&(0,s.jsxs)("div",{className:"ml-2 relative group",children:[(0,s.jsx)(p.g,{icon:b.zpE,className:"text-yellow-500"}),(0,s.jsx)("div",{className:"absolute left-1/2 -translate-x-1/2 bottom-full mb-2 px-2 py-1 text-xs text-white bg-black rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap z-10",children:i})]})]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("label",{className:`${P} ${o?"":"opacity-50 cursor-not-allowed"}`,children:[(0,s.jsx)("input",{type:"radio",className:D,checked:"client"===e,onChange:()=>{o&&(r.serverSetting.updateServerSettings({...r.serverSetting.serverSetting,enableServerAudio:0}),t("client"))},disabled:!o||n.isConverting}),"Client"]}),(0,s.jsxs)("label",{className:`${P} ${g?"":"opacity-50 cursor-not-allowed"}`,children:[(0,s.jsx)("input",{type:"radio",className:D,checked:"server"===e,onChange:()=>{g&&(r.serverSetting.updateServerSettings({...r.serverSetting.serverSetting,enableServerAudio:1}),t("server"))},disabled:!g||n.isConverting}),"Server"]})]})]})})};const ze=function(){const e=h(),[t,r]=(0,a.useState)([]),[n,i]=(0,a.useState)(""),[l,o]=(0,a.useState)(""),[d,c]=(0,a.useState)(""),[g,u]=(0,a.useState)(""),[m,x]=(0,a.useState)(""),v=(0,a.useMemo)((()=>e.serverSetting?.serverSetting?.serverAudioInputDevices.filter((e=>e.hostAPI===n))),[e.serverSetting,n]),p=(0,a.useMemo)((()=>e.serverSetting?.serverSetting?.serverAudioOutputDevices.filter((e=>e.hostAPI===n))),[e.serverSetting,n]),b=(0,a.useMemo)((()=>m?e.serverSetting?.serverSetting?.serverAudioOutputDevices.filter((e=>e.hostAPI===m)):[]),[e.serverSetting,m]);return(0,a.useEffect)((()=>{(async()=>{try{const t=e.serverSetting.serverSetting,s=t.serverAudioInputDevices||[],a=t.serverAudioOutputDevices||[],m=new Set;s.forEach((e=>e.hostAPI&&m.add(e.hostAPI))),a.forEach((e=>e.hostAPI&&m.add(e.hostAPI)));const x=Array.from(m);r(x),!(s.length>0)||l&&l.startsWith("server-")||o(`server-${s[0].index}`),a.length>0&&(d&&d.startsWith("server-")||c(`server-${a[0].index}`),g&&g.startsWith("server-")||u(`server-${a[0].index}`)),x.length>0&&!n&&i(x[0])}catch(e){}})()}),[e.serverSetting.serverSetting.enableServerAudio]),(0,a.useEffect)((()=>{n&&t.length>0&&(m&&t.includes(m)||(t.includes(n)?x(n):x(t[0])))}),[n,t,m]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"sampleRate",className:T,children:"Sample Rate"}),(0,s.jsx)("select",{id:"sampleRate",className:I,value:e.serverSetting?.serverSetting?.serverInputAudioSampleRate,onChange:t=>{e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,serverInputAudioSampleRate:parseInt(t.target.value),serverOutputAudioSampleRate:parseInt(t.target.value),serverMonitorAudioSampleRate:parseInt(t.target.value)})},children:[16e3,32e3,44100,48e3,96e3,192e3].map((e=>(0,s.jsxs)("option",{value:e,children:[e," Hz"]},e)))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"audioDriver",className:T,children:"Audio Driver"}),(0,s.jsx)("select",{id:"audioDriver",className:I,value:n,onChange:e=>{i(e.target.value)},children:0===t.length?(0,s.jsx)("option",{value:"",children:"No drivers available"}):t.map((e=>(0,s.jsx)("option",{value:e,children:e},e)))})]}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[(0,s.jsxs)("div",{className:"ASIO"===n?"w-[70%]":"w-full",children:[(0,s.jsx)("label",{htmlFor:"inputCh",className:T,children:"Input Device"}),(0,s.jsx)("select",{id:"inputCh",className:`${I} w-full`,value:e.serverSetting.serverSetting.serverInputDeviceId,onChange:t=>{e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,serverInputDeviceId:parseInt(t.target.value)})},children:0===v.length?(0,s.jsx)("option",{value:-1,children:"No input devices found"}):(0,s.jsxs)(s.Fragment,{children:[!v.find((t=>t.index===e.serverSetting.serverSetting.serverInputDeviceId))&&(0,s.jsx)("option",{value:-1,children:"No device selected"}),v.map((e=>(0,s.jsx)("option",{value:e.index,children:`[${e.hostAPI}] ${e.name}`},e.index)))]})})]}),"ASIO"===n&&v.find((t=>t.index===e.serverSetting.serverSetting.serverInputDeviceId))&&(0,s.jsxs)("div",{className:"w-[30%]",children:[(0,s.jsx)("label",{htmlFor:"inputChannel",className:T,children:"Channel"}),(0,s.jsxs)("select",{id:"inputChannel",className:`${I} w-full`,value:e.serverSetting.serverSetting.asioInputChannel,onChange:t=>{e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,asioInputChannel:parseInt(t.target.value)})},children:[(0,s.jsx)("option",{value:-1,children:"Default"}),Array.from({length:v.find((t=>t.index===e.serverSetting.serverSetting.serverInputDeviceId))?.maxInputChannels||0},((e,t)=>(0,s.jsx)("option",{value:t,children:t},t)))]})]})]})}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[(0,s.jsxs)("div",{className:"ASIO"===n?"w-[70%]":"w-full",children:[(0,s.jsx)("label",{htmlFor:"outputCh",className:T,children:"Output Device"}),(0,s.jsx)("select",{id:"outputCh",className:`${I} w-full`,value:e.serverSetting.serverSetting.serverOutputDeviceId,onChange:t=>{e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,serverOutputDeviceId:parseInt(t.target.value)})},children:0===p.length?(0,s.jsx)("option",{value:-1,children:"No output devices found"}):(0,s.jsxs)(s.Fragment,{children:[!p.find((t=>t.index===e.serverSetting.serverSetting.serverOutputDeviceId))&&(0,s.jsx)("option",{value:-1,children:"No device selected"}),p.map((e=>(0,s.jsx)("option",{value:e.index,children:`[${e.hostAPI}] ${e.name}`},e.index)))]})})]}),"ASIO"===n&&p.find((t=>t.index===e.serverSetting.serverSetting.serverOutputDeviceId))&&(0,s.jsxs)("div",{className:"w-[30%]",children:[(0,s.jsx)("label",{htmlFor:"outputChannel",className:T,children:"Channel"}),(0,s.jsxs)("select",{id:"outputChannel",className:`${I} w-full`,value:e.serverSetting.serverSetting.asioOutputChannel,onChange:t=>{e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,asioOutputChannel:parseInt(t.target.value)})},children:[(0,s.jsx)("option",{value:-1,children:"Default"}),Array.from({length:p.find((t=>t.index===e.serverSetting.serverSetting.serverOutputDeviceId))?.maxOutputChannels||0},((e,t)=>(0,s.jsx)("option",{value:t,children:t},t)))]})]})]})}),(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[(0,s.jsxs)("div",{className:"w-[30%]",children:[(0,s.jsx)("label",{htmlFor:"monitorAudioDriver",className:T,children:"Monitor Driver"}),(0,s.jsx)("select",{id:"monitorAudioDriver",className:`${I} w-full`,value:m,onChange:e=>{const t=e.target.value;x(t)},children:0===t.length?(0,s.jsx)("option",{value:"",children:"No drivers available"}):t.map((e=>(0,s.jsx)("option",{value:e,children:e},e)))})]}),(0,s.jsxs)("div",{className:"w-[70%]",children:[(0,s.jsx)("label",{htmlFor:"monCh",className:T,children:"Monitor Device"}),(0,s.jsx)("select",{id:"monCh",className:`${I} w-full`,value:e.serverSetting.serverSetting.serverMonitorDeviceId,onChange:t=>{e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,serverMonitorDeviceId:parseInt(t.target.value)})},disabled:!m||0===b.length,children:0===b.length?(0,s.jsx)("option",{value:-1,children:"No devices for driver"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("option",{value:-1,children:"No device selected"}),b.map((e=>(0,s.jsx)("option",{value:e.index,children:`[${e.hostAPI}] ${e.name}`},e.index)))]})})]})]})]})};const Ge=function(){const e=h(),[t,r]=(0,a.useState)(1),[n,i]=(0,a.useState)(1),[l,o]=(0,a.useState)(1);return(0,a.useEffect)((()=>{r(e.serverSetting.serverSetting.serverInputAudioGain),i(e.serverSetting.serverSetting.serverOutputAudioGain),o(e.serverSetting.serverSetting.serverMonitorAudioGain)}),[e.serverSetting.serverSetting.serverInputAudioGain,e.serverSetting.serverSetting.serverOutputAudioGain,e.serverSetting.serverSetting.serverMonitorAudioGain]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"inputGain",className:T,children:"Input Volume"}),(0,s.jsx)(ne,{id:"inputGain",min:10,max:250,step:1,value:Math.round(100*t),className:M,onChange:t=>{const r=t/100;e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,serverInputAudioGain:r}),e.setVoiceChangerClientSetting({...e.setting.voiceChangerClientSetting,inputGain:r})},onImmediateChange:e=>r(e/100)}),(0,s.jsxs)("p",{className:O,children:[Math.round(100*t),"%"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"outputGain",className:T,children:"Output Volume"}),(0,s.jsx)(ne,{id:"outputGain",min:10,max:400,step:1,value:Math.round(100*n),className:M,onChange:t=>{const r=t/100;e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,serverOutputAudioGain:r}),e.setVoiceChangerClientSetting({...e.setting.voiceChangerClientSetting,outputGain:r})},onImmediateChange:e=>i(e/100)}),(0,s.jsxs)("p",{className:O,children:[Math.round(100*n),"%"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"monitorGain",className:T,children:"Monitor Volume"}),(0,s.jsx)(ne,{id:"monitorGain",min:0,max:400,step:1,value:Math.round(100*l),className:M,onChange:t=>{const r=t/100;e.serverSetting.updateServerSettings({...e.serverSetting.serverSetting,serverMonitorAudioGain:r}),e.setVoiceChangerClientSetting({...e.setting.voiceChangerClientSetting,monitorGain:r})},onImmediateChange:e=>o(e/100)}),(0,s.jsxs)("p",{className:O,children:[Math.round(100*l),"%"]})]})]})};const _e=function(){const e=h(),t=N(),{getItem:r,setItem:n}=(0,m.useIndexedDB)({clientType:null});return(0,a.useEffect)((()=>{(async()=>{const s=await r(_);s&&t.setAudioOutputForGUI(s);const n=await r(B);n&&t.setAudioMonitorForGUI(n);const a=await r(G);a&&(e.setVoiceChangerClientSetting({...e.setting.voiceChangerClientSetting,audioInput:a}),t.setAudioInputForGUI(a))})()}),[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"inputCh",className:T,children:"Input Device"}),(0,s.jsx)("select",{id:"inputCh",className:I,value:t.audioInputForGUI,onChange:r=>{e.setting.voiceChangerClientSetting.audioInput=r.target.value,n(G,r.target.value),t.setAudioInputForGUI(r.target.value)},children:0===t.inputAudioDeviceInfo.length?(0,s.jsx)("option",{value:"",children:"No input devices found"}):t.inputAudioDeviceInfo.map((e=>(0,s.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId)))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"outputCh",className:T,children:"Output Device"}),(0,s.jsx)("select",{id:"outputCh",className:I,value:t.audioOutputForGUI,onChange:e=>{n(_,e.target.value),t.setAudioOutputForGUI(e.target.value)},children:0===t.outputAudioDeviceInfo.length?(0,s.jsx)("option",{value:"",children:"No output devices found"}):t.outputAudioDeviceInfo.map((e=>(0,s.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId)))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"monCh",className:T,children:"Monitor Device"}),(0,s.jsx)("select",{id:"monCh",className:I,value:t.audioMonitorForGUI,onChange:e=>{n(B,e.target.value),t.setAudioMonitorForGUI(e.target.value)},children:0===t.outputAudioDeviceInfo.length?(0,s.jsx)("option",{value:"",children:"No output devices found"}):t.outputAudioDeviceInfo.map((e=>(0,s.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId)))})]})]})};const Be=function({dndAttributes:e,dndListeners:t}){const r=h(),[n,i]=(0,a.useState)(!1),[l,o]=(0,a.useState)("client");return(0,a.useEffect)((()=>{1==r.serverSetting.serverSetting.enableServerAudio?o("server"):o("client")}),[r.serverSetting.serverSetting.enableServerAudio]),(0,s.jsxs)("div",{className:"p-4 border border-slate-200 dark:border-gray-700 rounded-md shadow-sm bg-white dark:bg-gray-800 transition-all duration-300 flex-1 min-h-0 flex flex-col "+(n?"h-auto":"overflow-y-auto"),children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3 pb-2 border-b border-slate-200 dark:border-gray-700",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("h4",{className:$,children:"Audio Settings"})}),(0,s.jsxs)("div",{className:"flex space-x-1 items-center",children:[(0,s.jsx)("button",{onClick:()=>i(!n),className:L,title:n?"Expand":"Collapse",children:(0,s.jsx)(p.g,{icon:n?b.Jt$:b.w2A,className:"h-5 w-5"})}),(0,s.jsx)(he,{attributes:e,listeners:t,title:"Drag"})]})]}),!n&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Ue,{audioState:l,setAudioState:o}),"client"===l?(0,s.jsx)(_e,{}):(0,s.jsx)(ze,{}),(0,s.jsx)(Ge,{})]})]})},Ve="modelSettings",We="performance",Ke="aiSettings",He="audioSettings";const Je=function({openModal:e}){const[t,r]=(0,a.useState)([Ve,We,Ke,He]),n=(0,ge.FR)((0,ge.MS)(ge.AN));return(0,s.jsx)(ge.Mp,{sensors:n,collisionDetection:ge.fp,onDragEnd:e=>{const{active:t,over:s}=e;s&&t.id!==s.id&&r((e=>{const r=e.indexOf(t.id),n=e.indexOf(s.id);return(0,ue.be)(e,r,n)}))},children:(0,s.jsx)(ue.gB,{items:t,children:(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.map((t=>{let r;switch(t){case"modelSettings":r=(0,s.jsx)(xe,{id:t,children:(t,r)=>(0,s.jsx)(be,{openModal:e,dndAttributes:t,dndListeners:r})},t);break;case"performance":r=(0,s.jsx)(xe,{id:t,children:(e,t)=>(0,s.jsx)(Re,{dndAttributes:e,dndListeners:t})},t);break;case"aiSettings":r=(0,s.jsx)(xe,{id:t,children:(e,t)=>(0,s.jsx)(Le,{dndAttributes:e,dndListeners:t})},t);break;case"audioSettings":r=(0,s.jsx)(xe,{id:t,children:(e,t)=>(0,s.jsx)(Be,{dndAttributes:e,dndListeners:t})},t);break;default:r=null}return r}))})})})};const Xe=function(){const[e,t]=(0,a.useState)(window.innerWidth>=768),[r,n]=(0,a.useState)(null);(0,a.useEffect)((()=>{const e=()=>{const e=window.innerWidth>=768;t(e)};return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)}),[]);const i=()=>{t(!e)},l=()=>{n(null)},o=(e,t)=>{let r={content:null,title:""},a=t||{};switch(e){case"advancedSettings":r={title:"Advanced Settings",content:(0,s.jsx)(ae,{}),primaryButton:{text:"Save",onClick:()=>{alert("Saving..."),l()}},secondaryButton:{text:"Close",onClick:()=>{l()}}};break;case"serverInfo":r={title:"Server Info",content:(0,s.jsx)(ie,{}),secondaryButton:{text:"Close",onClick:()=>{l()}}};break;case"clientInfo":r={title:"Client Info",content:(0,s.jsx)(le,{}),secondaryButton:{text:"Close",onClick:()=>{l()}}};break;case"editModel":const e=t;e?.model?r={title:`Edit Model: ${e.model.name}`,content:(0,s.jsx)(oe,{modelId:e.model.slotIndex.toString(),modelName:e.model.name}),primaryButton:{text:"Save Changes",onClick:()=>{alert(`Saving ${e.model?.name}...`),l()}}}:e?.modelId&&e?.modelName&&(r={title:`Edit Model: ${e.modelName}`,content:(0,s.jsx)(oe,{modelId:e.modelId,modelName:e.modelName}),primaryButton:{text:"Save Changes",onClick:()=>{alert(`Saving ${e.modelName}...`),l()}}}),a=e;break;case"deleteModel":const n=t;n?.model?r={title:`Delete Model: ${n.model.name}`,content:(0,s.jsx)(de,{modelId:n.model.slotIndex.toString(),modelName:n.model.name}),primaryButton:{text:"Delete",onClick:()=>{alert(`Deleting ${n.model?.name}...`),l()},className:"bg-red-600 hover:bg-red-700 focus:ring-red-500 text-white"},secondaryButton:{text:"Cancel",onClick:l}}:n?.modelId&&n?.modelName&&(r={title:`Delete Model: ${n.modelName}`,content:(0,s.jsx)(de,{modelId:n.modelId,modelName:n.modelName}),primaryButton:{text:"Delete",onClick:()=>{alert(`Deleting ${n.modelName}...`),l()},className:"bg-red-600 hover:bg-red-700 focus:ring-red-500 text-white"},secondaryButton:{text:"Cancel",onClick:l}}),a=n;break;case"passThrough":const i=t;r={title:i.title||"Confirm",content:(0,s.jsx)(ce,{...i,closeModal:l})},a=i;break;default:return}n({title:r.title||"Modal",content:r.content,props:a,primaryButton:r.primaryButton,secondaryButton:r.secondaryButton,transparent:!1})};return(0,s.jsxs)("div",{className:"flex flex-col h-screen font-sans bg-slate-50 dark:bg-gray-900 transition-colors duration-300",children:[(0,s.jsx)("button",{onClick:i,className:"md:hidden p-2 text-gray-600 dark:text-gray-300 fixed top-3 left-3 z-30 bg-gray-200 dark:bg-gray-700 rounded-md shadow","aria-label":"Toggle sidebar",children:(0,s.jsx)(p.g,{icon:e?b.GRI:b.ckx,size:"lg"})}),(0,s.jsxs)("div",{className:`flex flex-grow overflow-hidden ${!e&&window.innerWidth<768?"pt-0":"pt-12"} md:pt-0`,children:[(0,s.jsx)(Q,{isSidebarOpen:e,toggleSidebar:i,openModal:o}),(0,s.jsx)("main",{className:"flex-grow p-4 overflow-y-auto",children:(0,s.jsx)(Je,{openModal:o})})]}),(0,s.jsx)(se,{openModal:o}),r&&r.content&&(0,s.jsx)(Y,{isOpen:!!r,onClose:l,title:r.title,primaryButton:r.primaryButton,secondaryButton:r.secondaryButton,children:r.content})]})},Ye=({zIndex:e=50,particleCount:t=50,particleColor:r="rgba(200, 200, 255, 0.7)",backgroundColor:n="white"})=>{const i=(0,a.useRef)(null),l=(0,a.useRef)([]),o=(0,a.useRef)();return(0,a.useEffect)((()=>{const e=i.current;if(!e)return;const s=e.getContext("2d");if(!s)return;const n=()=>{e.width=window.innerWidth,e.height=window.innerHeight};n(),window.addEventListener("resize",n);((t,r)=>{l.current=[];for(let s=0;s<t;s++)l.current.push({x:Math.random()*e.width,y:Math.random()*e.height,vx:1*Math.random()-.5,vy:1*Math.random()-.5,radius:2*Math.random()+1,alpha:.5*Math.random()+.2,color:r})})(t,r);const a=()=>{s.clearRect(0,0,e.width,e.height),l.current.forEach((t=>{t.x+=t.vx,t.y+=t.vy,t.x<0&&(t.x=e.width),t.x>e.width&&(t.x=0),t.y<0&&(t.y=e.height),t.y>e.height&&(t.y=0),s.beginPath(),s.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),s.fillStyle=t.color,s.globalAlpha=t.alpha,s.fill()})),s.globalAlpha=1,o.current=requestAnimationFrame(a)};return a(),()=>{window.removeEventListener("resize",n),o.current&&cancelAnimationFrame(o.current)}}),[]),(0,s.jsx)("canvas",{ref:i,style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",zIndex:e,pointerEvents:"none",backgroundColor:n}})},qe=({onGetStarted:e})=>(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Welcome to the Voice Changer App"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:'Click on "Continue" to start the application and initialize the audio engine.'})]}),(0,s.jsx)("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[(0,s.jsx)("strong",{children:"Note:"})," For optimal functionality, this app requires access to your audio system."]})})]}),Qe=()=>{const[e,t]=i().useState(!0),{theme:r}=g(),n=async()=>{t(!1)},a="dark"===r?{particleColor:"rgba(147, 197, 253, 0.6)",backgroundColor:"rgb(17, 24, 39)"}:{particleColor:"rgba(59, 130, 246, 0.4)",backgroundColor:"rgb(248, 250, 252)"};return e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Ye,{zIndex:1,particleCount:100,particleColor:a.particleColor,backgroundColor:a.backgroundColor}),(0,s.jsx)(Y,{isOpen:!0,transparent:!0,onClose:n,title:"RVC VoiceChanger",primaryButton:{text:"Continue",onClick:n},children:(0,s.jsx)(qe,{onGetStarted:n})})]}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(v,{children:(0,s.jsx)(y,{children:(0,s.jsx)(Xe,{})})})})},Ze=document.getElementById("root");if(!Ze)throw new Error("Failed to find the root element");n.createRoot(Ze).render((0,s.jsx)(u,{children:(0,s.jsx)((({children:e})=>{const t=(()=>{const[e,t]=(0,a.useState)(null);return(0,a.useEffect)((()=>{const e=()=>{const r=new URL(window.location.href).searchParams.get("sample_rate"),s=r?new AudioContext({sampleRate:Number(r)}):new AudioContext({sampleRate:48e3});t(s),document.removeEventListener("touchstart",e),document.removeEventListener("mousedown",e)};document.addEventListener("touchstart",e,!1),document.addEventListener("mousedown",e,!1)}),[]),{audioContext:e}})(),r=(()=>{const[e,t]=(0,a.useState)(!1),[r,s]=(0,a.useState)(l),[n,i]=(0,a.useState)(""),[o,d]=(0,a.useState)("");return(0,a.useEffect)((()=>{(async()=>{const e=await fetch("http://127.0.0.1:18888/version"),t=await e.text();i(t)})()}),[]),(0,a.useEffect)((()=>{(async()=>{const e=await fetch("http://127.0.0.1:18888/edition"),t=await e.text();d(t)})()}),[]),{appGuiSetting:r,guiSettingLoaded:e,version:n,edition:o,getAppGuiSetting:async e=>{const r=await fetch(`${e}`,{method:"GET"}),n=await r.json();s(n),t(!0)},clearAppGuiSetting:()=>{s(l),t(!1)}}})(),n={audioContextState:t,appGuiSettingState:r,getGUISetting:async()=>{await r.getAppGuiSetting("/assets/gui_settings/GUI.json")}};return(0,s.jsx)(o.Provider,{value:n,children:e})}),{children:(0,s.jsx)((()=>(0,s.jsx)(u,{children:(0,s.jsx)(Qe,{})})),{})})}))}},e=>{e.O(0,[644,453,96],(()=>{return t=7167,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=main.da08822f62b36d75af5f.js.map